<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一、准备工作">
<meta property="og:type" content="article">
<meta property="og:title" content="通过DHT11温度测量和NRF24L01无线通信控制电机转动">
<meta property="og:url" content="http://example.com/2021/12/03/%E9%80%9A%E8%BF%87DHT11%E6%B8%A9%E5%BA%A6%E6%B5%8B%E9%87%8F%E5%92%8CNRF24L01%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E6%8E%A7%E5%88%B6%E7%94%B5%E6%9C%BA%E8%BD%AC%E5%8A%A8/index.html">
<meta property="og:site_name" content="INVINCIBLEの博客">
<meta property="og:description" content="一、准备工作">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-03T11:56:17.000Z">
<meta property="article:modified_time" content="2021-12-03T12:13:41.725Z">
<meta property="article:author" content="invincible">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2021/12/03/%E9%80%9A%E8%BF%87DHT11%E6%B8%A9%E5%BA%A6%E6%B5%8B%E9%87%8F%E5%92%8CNRF24L01%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E6%8E%A7%E5%88%B6%E7%94%B5%E6%9C%BA%E8%BD%AC%E5%8A%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>通过DHT11温度测量和NRF24L01无线通信控制电机转动 | INVINCIBLEの博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">INVINCIBLEの博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">3</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/03/%E9%80%9A%E8%BF%87DHT11%E6%B8%A9%E5%BA%A6%E6%B5%8B%E9%87%8F%E5%92%8CNRF24L01%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E6%8E%A7%E5%88%B6%E7%94%B5%E6%9C%BA%E8%BD%AC%E5%8A%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="invincible">
      <meta itemprop="description" content="生活不易，且行珍惜。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="INVINCIBLEの博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          通过DHT11温度测量和NRF24L01无线通信控制电机转动
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-12-03 19:56:17 / 修改时间：20:13:41" itemprop="dateCreated datePublished" datetime="2021-12-03T19:56:17+08:00">2021-12-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作<span id="more"></span></h1><table>
<thead>
<tr>
<th>元器件</th>
<th>数量</th>
</tr>
</thead>
<tbody><tr>
<td>stm32F103C8T6</td>
<td>2</td>
</tr>
<tr>
<td>28BYJ-48步进电机</td>
<td>1</td>
</tr>
<tr>
<td>uln2003</td>
<td>1</td>
</tr>
<tr>
<td>nrf24l01</td>
<td>2</td>
</tr>
<tr>
<td>dht11模块</td>
<td>1</td>
</tr>
</tbody></table>
<h1 id="二、发送端"><a href="#二、发送端" class="headerlink" title="二、发送端"></a>二、发送端</h1><h2 id="DHT11模块"><a href="#DHT11模块" class="headerlink" title="DHT11模块"></a>DHT11模块</h2><p>DHT11用来测量温度</p>
<p>dht11.h</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ifndef __DHT11_H</span></span><br><span class="line"><span class="comment">#define __DHT11_H   </span></span><br><span class="line"><span class="comment">#include &quot;sys.h&quot;</span></span><br><span class="line"> </span><br><span class="line">//IO方向设置</span><br><span class="line"><span class="comment">#define DHT11_IO_IN()  &#123;GPIOB-&gt;CRL&amp;=0XFFFFFFF0;GPIOB-&gt;CRL|=8&lt;&lt;0;&#125;</span></span><br><span class="line"><span class="comment">#define DHT11_IO_OUT() &#123;GPIOB-&gt;CRL&amp;=0XFFFFFFF0;GPIOB-&gt;CRL|=3&lt;&lt;0;&#125;</span></span><br><span class="line">//IO操作函数											   </span><br><span class="line"><span class="comment">#define	DHT11_DQ_OUT PBout(0)</span></span><br><span class="line"><span class="comment">#define	DHT11_DQ_IN  PBin(0) </span></span><br><span class="line"> </span><br><span class="line">u8 DHT11_Init(void);</span><br><span class="line">u8 DHT11_Read_Data(u8 *temp,u8 *humi);</span><br><span class="line">u8 DHT11_Read_Byte(void);</span><br><span class="line">u8 DHT11_Read_Bit(void);</span><br><span class="line">void DHT11_Rst(void);</span><br><span class="line">u8 DHT11_Check(void);</span><br><span class="line"> </span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>dht11.c</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;dht11.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;delay.h&quot;</span></span><br><span class="line"> </span><br><span class="line">//初始化DHT11</span><br><span class="line">//返回：初始化的状态（应答信号）</span><br><span class="line">u8 DHT11_Init()</span><br><span class="line">&#123;</span><br><span class="line">	GPIO_InitTypeDef GPIO_InitStruce;</span><br><span class="line">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB,ENABLE);		//利用引脚PA0</span><br><span class="line">	</span><br><span class="line">	GPIO_InitStruce.GPIO_Pin = GPIO_Pin_0;</span><br><span class="line">	GPIO_InitStruce.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">	GPIO_InitStruce.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">	GPIO_Init(GPIOB,&amp;GPIO_InitStruce);</span><br><span class="line"> </span><br><span class="line">	DHT11_Rst();</span><br><span class="line">	<span class="keyword">return</span> DHT11_Check();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//复位DHT11</span><br><span class="line">void DHT11_Rst(void)	   </span><br><span class="line">&#123;                 </span><br><span class="line">    DHT11_IO_OUT(); 	//SET OUTPUT</span><br><span class="line">    DHT11_DQ_OUT=<span class="number">0</span>; 	//拉低DQ</span><br><span class="line">    delay_ms(<span class="number">20</span>);    	//拉低至少18ms</span><br><span class="line">    DHT11_DQ_OUT=<span class="number">1</span>; 	//DQ=<span class="number">1</span> </span><br><span class="line">    delay_us(<span class="number">30</span>);     	//主机拉高<span class="number">20</span>~40us</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//等待DHT11的回应</span><br><span class="line">//返回<span class="number">1</span>:未检测到DHT11的存在</span><br><span class="line">//返回<span class="number">0</span>:存在</span><br><span class="line">u8 DHT11_Check(void) 	   </span><br><span class="line">&#123;   </span><br><span class="line">   u8 retry=<span class="number">0</span>;</span><br><span class="line">   DHT11_IO_IN();//SET INPUT	 </span><br><span class="line">   <span class="keyword">while</span> (DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)//DHT11会拉低<span class="number">40</span>~80us</span><br><span class="line">   &#123;</span><br><span class="line">		retry++;   </span><br><span class="line">		delay_us(<span class="number">1</span>);</span><br><span class="line">   &#125;;	 </span><br><span class="line">   <span class="keyword">if</span>(retry&gt;=<span class="number">100</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">else</span> retry=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">while</span> (!DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)//DHT11拉低后会再次拉高<span class="number">40</span>~80us</span><br><span class="line">   &#123;</span><br><span class="line">       retry++;  </span><br><span class="line">	   delay_us(<span class="number">1</span>);</span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="keyword">if</span>(retry&gt;=<span class="number">100</span>)<span class="keyword">return</span> <span class="number">1</span>;	    </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//从DHT11读取一个位   </span><br><span class="line">//返回值：<span class="number">1</span>/<span class="number">0</span></span><br><span class="line">u8 DHT11_Read_Bit(void) 			 </span><br><span class="line">&#123;</span><br><span class="line">      u8 retry=<span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span>(DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)//等待变为低电平</span><br><span class="line">      &#123;</span><br><span class="line">             retry++;   </span><br><span class="line">             delay_us(<span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line">      retry=<span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span>(!DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)//等待变高电平</span><br><span class="line">       &#123;</span><br><span class="line">              retry++;	</span><br><span class="line">              delay_us(<span class="number">1</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      delay_us(<span class="number">40</span>);//等待40us</span><br><span class="line">      <span class="keyword">if</span>(DHT11_DQ_IN)</span><br><span class="line">		  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span> </span><br><span class="line">		  <span class="keyword">return</span> <span class="number">0</span>;		   </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//从DHT11读取一个字节</span><br><span class="line">//返回值：读到的数据</span><br><span class="line">u8 DHT11_Read_Byte(void)    </span><br><span class="line">&#123;        </span><br><span class="line">    u8 i,dat;</span><br><span class="line">    dat=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++) </span><br><span class="line">  &#123;</span><br><span class="line">      dat&lt;&lt;=<span class="number">1</span>; </span><br><span class="line">     dat|=DHT11_Read_Bit();</span><br><span class="line">    &#125;				    </span><br><span class="line">    <span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//从DHT11读取一次数据</span><br><span class="line">//temp:温度值(范围:<span class="number">0</span>~<span class="number">50</span>°)     humi:湿度值(范围:<span class="number">20</span>%~<span class="number">90</span>%)</span><br><span class="line">//返回值：<span class="number">0</span>,正常;<span class="number">1</span>,读取失败</span><br><span class="line">u8 DHT11_Read_Data(u8 *temp,u8 *humi)    </span><br><span class="line">&#123;        </span><br><span class="line">    u8 buf[<span class="number">5</span>];</span><br><span class="line">    u8 i;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    <span class="keyword">if</span>(DHT11_Check()==<span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">          <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)//读取<span class="number">40</span>位数据</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=DHT11_Read_Byte();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>((buf[<span class="number">0</span>]+buf[<span class="number">1</span>]+buf[<span class="number">2</span>]+buf[<span class="number">3</span>])==buf[<span class="number">4</span>])</span><br><span class="line">		&#123;</span><br><span class="line">			*humi=buf[<span class="number">0</span>];</span><br><span class="line">			*temp=buf[<span class="number">2</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><p>main.c</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#include	&quot;stm32f10x.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;system.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;delay.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;usart.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;nrf24l01p.h&quot;	</span></span><br><span class="line"><span class="comment">#include	&quot;spi2.h&quot;</span></span><br><span class="line"><span class="comment">#include  &quot;led.h&quot;</span></span><br><span class="line"><span class="comment">#include  &quot;dht11.h&quot;</span></span><br><span class="line"><span class="comment">#include  &quot;stdio.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(void)</span><br><span class="line">&#123;</span><br><span class="line">	u8 temperature=<span class="number">0</span>;  	    </span><br><span class="line">	u8 humidity;</span><br><span class="line">	u8 key,mode;</span><br><span class="line">	u8 t=<span class="number">0</span>;			 </span><br><span class="line">	u8 tmp_buf[<span class="number">180</span>];		    </span><br><span class="line">	delay_init();	    	 														//延时函数初始化	  </span><br><span class="line">	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);	//设置中断优先级分组为组<span class="number">2</span>：<span class="number">2</span>位抢占优先级，<span class="number">2</span>位响应优先级</span><br><span class="line">	USART1_Config();	 															//串口初始化为<span class="number">115200</span></span><br><span class="line"> 	NRF24L01_Init();	//初始化NRF24L01</span><br><span class="line">	LED_Init();</span><br><span class="line">	DHT11_Init();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(DHT11_Init())	//DHT11初始化	</span><br><span class="line">	&#123;</span><br><span class="line">		printf(<span class="string">&quot;DHT11 Error\r\n&quot;</span>);</span><br><span class="line">		delay_ms(<span class="number">200</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(NRF24L01_Check())		//等待模块应答</span><br><span class="line">	&#123;</span><br><span class="line">		printf(<span class="string">&quot;NRF24L01 Error\r\n&quot;</span>);</span><br><span class="line">		delay_ms(<span class="number">500</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(<span class="string">&quot;NRF24L01 OK\r\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	//mode=<span class="number">1</span>;//接收模式</span><br><span class="line">//	mode=<span class="number">1</span>;//发送模式</span><br><span class="line">	</span><br><span class="line"> /*	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(mode==<span class="number">0</span>)//RX模式</span><br><span class="line">		&#123;</span><br><span class="line">			printf(<span class="string">&quot;NRF24L01 RX_Mode\r\n&quot;</span>);</span><br><span class="line">			printf(<span class="string">&quot;Received DATA:&quot;</span>);</span><br><span class="line">			NRF24L01_RX_Mode();</span><br><span class="line">			<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(NRF24L01_RxPacket(tmp_buf)==<span class="number">0</span>)//一旦接收到信息,则显示出来.</span><br><span class="line">				&#123;</span><br><span class="line">					tmp_buf[<span class="number">32</span>]=<span class="number">0</span>;//加入字符串结束符</span><br><span class="line">					printf(<span class="string">&quot;%s\r\n&quot;</span>,tmp_buf);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> delay_us(<span class="number">100</span>);			    </span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>//TX模式  */</span><br><span class="line">		</span><br><span class="line">			//printf(<span class="string">&quot;NRF24L01 TX_Mode\r\n&quot;</span>);</span><br><span class="line">			NRF24L01_TX_Mode();</span><br><span class="line">			//mode=<span class="number">3</span>;//从空格键开始</span><br><span class="line">			</span><br><span class="line">		<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(NRF24L01_TxPacket(&amp;temperature)==TX_OK)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(t%<span class="number">10</span>==<span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					printf(<span class="string">&quot;%d&quot;</span>,t);</span><br><span class="line">					DHT11_Read_Data(&amp;temperature,&amp;humidity);</span><br><span class="line">					//tmp_buf[t]=temperature;</span><br><span class="line">					printf(<span class="string">&quot;Sended DATA:&quot;</span>);</span><br><span class="line">					printf(<span class="string">&quot;%d\n&quot;</span>,temperature);</span><br><span class="line">				&#125;</span><br><span class="line">				delay_ms(<span class="number">10</span>);</span><br><span class="line">				LED0=!LED0;</span><br><span class="line">				  t++;</span><br><span class="line">				  </span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				//printf(<span class="string">&quot;Sended DATA:&quot;</span>);</span><br><span class="line">				//printf(<span class="string">&quot;%d\r\n&quot;</span>,tmp_buf);</span><br><span class="line">				//printf(<span class="string">&quot;%s\r\n&quot;</span>,tmp_buf[t]);</span><br><span class="line">				</span><br><span class="line">				//发送的内容(修改发送的内容)</span><br><span class="line">				//key=mode;</span><br><span class="line">				//<span class="keyword">for</span>(t=<span class="number">0</span>;t&lt;<span class="number">32</span>;t++)</span><br><span class="line">				//&#123;</span><br><span class="line">				//	tmp_buf[t]=key;</span><br><span class="line">				//&#125;</span><br><span class="line">				</span><br><span class="line">				//tmp_buf[<span class="number">0</span>]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">1</span>]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">2</span>]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">3</span>]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">4</span>]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">5</span>]=<span class="string">&#x27;5&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">6</span>]=<span class="string">&#x27;6&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">7</span>]=<span class="string">&#x27;7&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">8</span>]=<span class="string">&#x27;8&#x27;</span>;</span><br><span class="line">				//tmp_buf[<span class="number">9</span>]=<span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">				</span><br><span class="line">				//delay_ms(<span class="number">10</span>);</span><br><span class="line">				//tmp_buf[<span class="number">32</span>]=<span class="number">0</span>;//加入结束符</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;										   	</span><br><span class="line">				printf(<span class="string">&quot;Send Failed \r\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			delay_ms(<span class="number">1500</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="三、双端"><a href="#三、双端" class="headerlink" title="三、双端"></a>三、双端</h1><h2 id="NRF24L01模块"><a href="#NRF24L01模块" class="headerlink" title="NRF24L01模块"></a>NRF24L01模块</h2><p>nrf24l01.h</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ifndef __24L01_H</span></span><br><span class="line"><span class="comment">#define __24L01_H	 		  </span></span><br><span class="line"><span class="comment">#include &quot;system.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;delay.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;spi2.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;usart.h&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//NRF24L01寄存器操作命令</span><br><span class="line"><span class="comment">#define NRF_READ_REG    0x00  //读配置寄存器,低5位为寄存器地址</span></span><br><span class="line"><span class="comment">#define NRF_WRITE_REG   0x20  //写配置寄存器,低5位为寄存器地址</span></span><br><span class="line"><span class="comment">#define RD_RX_PLOAD     0x61  //读RX有效数据,1~32字节</span></span><br><span class="line"><span class="comment">#define WR_TX_PLOAD     0xA0  //写TX有效数据,1~32字节</span></span><br><span class="line"><span class="comment">#define FLUSH_TX        0xE1  //清除TX FIFO寄存器.发射模式下用</span></span><br><span class="line"><span class="comment">#define FLUSH_RX        0xE2  //清除RX FIFO寄存器.接收模式下用</span></span><br><span class="line"><span class="comment">#define REUSE_TX_PL     0xE3  //重新使用上一包数据,CE为高,数据包被不断发送.</span></span><br><span class="line"><span class="comment">#define NOP             0xFF  //空操作,可以用来读状态寄存器	 </span></span><br><span class="line">//SPI(NRF24L01)寄存器地址</span><br><span class="line"><span class="comment">#define CONFIG          0x00  //配置寄存器地址;bit0:1接收模式,0发射模式;bit1:电选择;bit2:CRC模式;bit3:CRC使能;</span></span><br><span class="line">                              //bit4:中断MAX_RT(达到最大重发次数中断)使能;bit5:中断TX_DS使能;bit6:中断RX_DR使能</span><br><span class="line"><span class="comment">#define EN_AA           0x01  //使能自动应答功能  bit0~5,对应通道0~5</span></span><br><span class="line"><span class="comment">#define EN_RXADDR       0x02  //接收地址允许,bit0~5,对应通道0~5</span></span><br><span class="line"><span class="comment">#define SETUP_AW        0x03  //设置地址宽度(所有数据通道):bit1,0:00,3字节;01,4字节;02,5字节;</span></span><br><span class="line"><span class="comment">#define SETUP_RETR      0x04  //建立自动重发;bit3:0,自动重发计数器;bit7:4,自动重发延时 250*x+86us</span></span><br><span class="line"><span class="comment">#define RF_CH           0x05  //RF通道,bit6:0,工作通道频率;</span></span><br><span class="line"><span class="comment">#define RF_SETUP        0x06  //RF寄存器;bit3:传输速率(0:1Mbps,1:2Mbps);bit2:1,发射功率;bit0:低噪声放大器增益</span></span><br><span class="line"><span class="comment">#define STATUS          0x07  //状态寄存器;bit0:TX FIFO满标志;bit3:1,接收数据通道号(最大:6);bit4,达到最多次重发</span></span><br><span class="line">                              //bit5:数据发送完成中断;bit6:接收数据中断;</span><br><span class="line"><span class="comment">#define MAX_TX  				0x10  //达到最大发送次数中断</span></span><br><span class="line"><span class="comment">#define TX_OK   				0x20  //TX发送完成中断</span></span><br><span class="line"><span class="comment">#define RX_OK   				0x40  //接收到数据中断</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define OBSERVE_TX      0x08  //发送检测寄存器,bit7:4,数据包丢失计数器;bit3:0,重发计数器</span></span><br><span class="line"><span class="comment">#define CD              0x09  //载波检测寄存器,bit0,载波检测;</span></span><br><span class="line"><span class="comment">#define RX_ADDR_P0      0x0A  //数据通道0接收地址,最大长度5个字节,低字节在前</span></span><br><span class="line"><span class="comment">#define RX_ADDR_P1      0x0B  //数据通道1接收地址,最大长度5个字节,低字节在前</span></span><br><span class="line"><span class="comment">#define RX_ADDR_P2      0x0C  //数据通道2接收地址,最低字节可设置,高字节,必须同RX_ADDR_P1[39:8]相等;</span></span><br><span class="line"><span class="comment">#define RX_ADDR_P3      0x0D  //数据通道3接收地址,最低字节可设置,高字节,必须同RX_ADDR_P1[39:8]相等;</span></span><br><span class="line"><span class="comment">#define RX_ADDR_P4      0x0E  //数据通道4接收地址,最低字节可设置,高字节,必须同RX_ADDR_P1[39:8]相等;</span></span><br><span class="line"><span class="comment">#define RX_ADDR_P5      0x0F  //数据通道5接收地址,最低字节可设置,高字节,必须同RX_ADDR_P1[39:8]相等;</span></span><br><span class="line"><span class="comment">#define TX_ADDR         0x10  //发送地址(低字节在前),ShockBurstTM模式下,RX_ADDR_P0与此地址相等</span></span><br><span class="line"><span class="comment">#define RX_PW_P0        0x11  //接收数据通道0有效数据宽度(1~32字节),设置为0则非法</span></span><br><span class="line"><span class="comment">#define RX_PW_P1        0x12  //接收数据通道1有效数据宽度(1~32字节),设置为0则非法</span></span><br><span class="line"><span class="comment">#define RX_PW_P2        0x13  //接收数据通道2有效数据宽度(1~32字节),设置为0则非法</span></span><br><span class="line"><span class="comment">#define RX_PW_P3        0x14  //接收数据通道3有效数据宽度(1~32字节),设置为0则非法</span></span><br><span class="line"><span class="comment">#define RX_PW_P4        0x15  //接收数据通道4有效数据宽度(1~32字节),设置为0则非法</span></span><br><span class="line"><span class="comment">#define RX_PW_P5        0x16  //接收数据通道5有效数据宽度(1~32字节),设置为0则非法</span></span><br><span class="line"><span class="comment">#define NRF_FIFO_STATUS 0x17  //FIFO状态寄存器;bit0,RX FIFO寄存器空标志;bit1,RX FIFO满标志;bit2,3,保留</span></span><br><span class="line">                              //bit4,TX FIFO空标志;bit5,TX FIFO满标志;bit6,<span class="number">1</span>,循环发送上一数据包<span class="number">.0</span>,不循环;</span><br><span class="line">//////////////////////////////////////////////////////////////////////////////////////////////////////////</span><br><span class="line">//24L01操作线</span><br><span class="line"><span class="comment">#define NRF24L01_CE   PAout(7) //24L01片选信号</span></span><br><span class="line"><span class="comment">#define NRF24L01_CSN  PAout(6) //SPI片选信号	   </span></span><br><span class="line"><span class="comment">#define NRF24L01_IRQ  PAin(5)  //IRQ主机数据输入</span></span><br><span class="line">//24L01发送接收数据宽度定义</span><br><span class="line"><span class="comment">#define TX_ADR_WIDTH    5   	//5字节的地址宽度</span></span><br><span class="line"><span class="comment">#define RX_ADR_WIDTH    5   	//5字节的地址宽度</span></span><br><span class="line"><span class="comment">#define TX_PLOAD_WIDTH  32  	//32字节的用户数据宽度</span></span><br><span class="line"><span class="comment">#define RX_PLOAD_WIDTH  32  	//32字节的用户数据宽度</span></span><br><span class="line">									   	   </span><br><span class="line"></span><br><span class="line">void NRF24L01_Init(void);						//初始化</span><br><span class="line">void NRF24L01_RX_Mode(void);					//配置为接收模式</span><br><span class="line">void NRF24L01_TX_Mode(void);					//配置为发送模式</span><br><span class="line">u8 NRF24L01_Write_Buf(u8 reg, u8 *pBuf, u8 u8s);//写数据区</span><br><span class="line">u8 NRF24L01_Read_Buf(u8 reg, u8 *pBuf, u8 u8s);	//读数据区		  </span><br><span class="line">u8 NRF24L01_Read_Reg(u8 reg);					//读寄存器</span><br><span class="line">u8 NRF24L01_Write_Reg(u8 reg, u8 value);		//写寄存器</span><br><span class="line">u8 NRF24L01_Check(void);						//检查24L01是否存在</span><br><span class="line">u8 NRF24L01_TxPacket(u8 *txbuf);				//发送一个包的数据</span><br><span class="line">u8 NRF24L01_RxPacket(u8 *rxbuf);				//接收一个包的数据</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nrf24l01.c</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;nrf24l01p.h&quot;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">const u8 TX_ADDRESS[TX_ADR_WIDTH]=&#123;<span class="number">0x34</span>,<span class="number">0x43</span>,<span class="number">0x10</span>,<span class="number">0x10</span>,<span class="number">0x01</span>&#125;; //发送地址</span><br><span class="line">const u8 RX_ADDRESS[RX_ADR_WIDTH]=&#123;<span class="number">0x34</span>,<span class="number">0x43</span>,<span class="number">0x10</span>,<span class="number">0x10</span>,<span class="number">0x01</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//初始化24L01的IO口</span><br><span class="line">void NRF24L01_Init(void)</span><br><span class="line">&#123; 	</span><br><span class="line">	GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">  SPI_InitTypeDef  SPI_InitStructure;</span><br><span class="line"></span><br><span class="line">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA|RCC_APB2Periph_GPIOB, ENABLE);	 //使能PB,G端口时钟</span><br><span class="line">	</span><br><span class="line">	//<span class="number">5</span>:IRQ <span class="number">6</span>:CSN <span class="number">7</span>:CE</span><br><span class="line">	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6|GPIO_Pin_7;	//PA6 <span class="number">7</span> 推挽</span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 		 //推挽输出</span><br><span class="line"> 	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line"> 	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);//初始化指定IO</span><br><span class="line">  </span><br><span class="line">	GPIO_InitStructure.GPIO_Pin  = GPIO_Pin_5;   </span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPD; //PA7 输入  </span><br><span class="line">	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line">	</span><br><span class="line">	GPIO_ResetBits(GPIOA,GPIO_Pin_5|GPIO_Pin_6|GPIO_Pin_7);//PA5,<span class="number">6</span>,<span class="number">7</span>上拉</span><br><span class="line">	</span><br><span class="line">  SPI2_Init();    		//初始化SPI	 </span><br><span class="line"> </span><br><span class="line">	SPI_Cmd(SPI2, DISABLE); // SPI外设不使能</span><br><span class="line"></span><br><span class="line">	SPI_InitStructure.SPI_Direction = SPI_Direction_2Lines_FullDuplex;  //SPI设置为双线双向全双工</span><br><span class="line">	SPI_InitStructure.SPI_Mode = SPI_Mode_Master;												//SPI主机</span><br><span class="line">  SPI_InitStructure.SPI_DataSize = SPI_DataSize_8b;										//发送接收<span class="number">8</span>位帧结构</span><br><span class="line">	SPI_InitStructure.SPI_CPOL = SPI_CPOL_Low;													//时钟悬空低</span><br><span class="line">	SPI_InitStructure.SPI_CPHA = SPI_CPHA_1Edge;												//数据捕获于第<span class="number">1</span>个时钟沿</span><br><span class="line">	SPI_InitStructure.SPI_NSS = SPI_NSS_Soft;														//NSS信号由软件控制</span><br><span class="line">	SPI_InitStructure.SPI_BaudRatePrescaler = SPI_BaudRatePrescaler_16;	//定义波特率预分频的值:波特率预分频值为<span class="number">16</span></span><br><span class="line">	SPI_InitStructure.SPI_FirstBit = SPI_FirstBit_MSB;									//数据传输从MSB位开始</span><br><span class="line">	SPI_InitStructure.SPI_CRCPolynomial = <span class="number">7</span>;														//CRC值计算的多项式</span><br><span class="line">	SPI_Init(SPI2, &amp;SPI_InitStructure);																	//根据SPI_InitStruct中指定的参数初始化外设SPIx寄存器</span><br><span class="line">	</span><br><span class="line">	SPI_Cmd(SPI2, ENABLE); //使能SPI外设</span><br><span class="line">			 </span><br><span class="line">	NRF24L01_CE=<span class="number">0</span>; 			//使能24L01</span><br><span class="line">	NRF24L01_CSN=<span class="number">1</span>;			//SPI片选取消</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//检测24L01是否存在</span><br><span class="line">//返回值:<span class="number">0</span>，成功;<span class="number">1</span>，失败	</span><br><span class="line">u8 NRF24L01_Check(void)</span><br><span class="line">&#123;</span><br><span class="line">	u8 buf[<span class="number">5</span>]=&#123;<span class="number">0XA5</span>,<span class="number">0XA5</span>,<span class="number">0XA5</span>,<span class="number">0XA5</span>,<span class="number">0XA5</span>&#125;;</span><br><span class="line">	u8 i;</span><br><span class="line">	SPI2_SetSpeed(SPI_BaudRatePrescaler_8); //spi速度为9Mhz（24L01的最大SPI时钟为10Mhz）   	 </span><br><span class="line">	NRF24L01_Write_Buf(NRF_WRITE_REG+TX_ADDR,buf,<span class="number">5</span>);//写入<span class="number">5</span>个字节的地址.	</span><br><span class="line">	NRF24L01_Read_Buf(TX_ADDR,buf,<span class="number">5</span>); //读出写入的地址  </span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)<span class="keyword">if</span>(buf[i]!=<span class="number">0XA5</span>)<span class="keyword">break</span>;	 							   </span><br><span class="line">	<span class="keyword">if</span>(i!=<span class="number">5</span>)<span class="keyword">return</span> <span class="number">1</span>;//检测24L01错误	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;		 //检测到24L01</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//SPI写寄存器</span><br><span class="line">//reg:指定寄存器地址</span><br><span class="line">//value:写入的值</span><br><span class="line">u8 NRF24L01_Write_Reg(u8 reg,u8 value)</span><br><span class="line">&#123;</span><br><span class="line">	u8 status;	</span><br><span class="line">   	NRF24L01_CSN=<span class="number">0</span>;                 //使能SPI传输</span><br><span class="line">  	status =SPI2_ReadWriteByte(reg);//发送寄存器号 </span><br><span class="line">  	SPI2_ReadWriteByte(value);      //写入寄存器的值</span><br><span class="line">  	NRF24L01_CSN=<span class="number">1</span>;                 //禁止SPI传输	   </span><br><span class="line">  	<span class="keyword">return</span>(status);       			//返回状态值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//读取SPI寄存器值</span><br><span class="line">//reg:要读的寄存器</span><br><span class="line">u8 NRF24L01_Read_Reg(u8 reg)</span><br><span class="line">&#123;</span><br><span class="line">	u8 reg_val;	    </span><br><span class="line"> 	NRF24L01_CSN = <span class="number">0</span>;          //使能SPI传输		</span><br><span class="line">  	SPI2_ReadWriteByte(reg);   //发送寄存器号</span><br><span class="line">  	reg_val=SPI2_ReadWriteByte(<span class="number">0XFF</span>);//读取寄存器内容</span><br><span class="line">  	NRF24L01_CSN = <span class="number">1</span>;          //禁止SPI传输		    </span><br><span class="line">  	<span class="keyword">return</span>(reg_val);           //返回状态值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//在指定位置读出指定长度的数据</span><br><span class="line">//reg:寄存器(位置)</span><br><span class="line">//*pBuf:数据指针</span><br><span class="line">//<span class="built_in">len</span>:数据长度</span><br><span class="line">//返回值,此次读到的状态寄存器值 </span><br><span class="line">u8 NRF24L01_Read_Buf(u8 reg,u8 *pBuf,u8 <span class="built_in">len</span>)</span><br><span class="line">&#123;</span><br><span class="line">	u8 status,u8_ctr;	       </span><br><span class="line">  NRF24L01_CSN = <span class="number">0</span>;           //使能SPI传输</span><br><span class="line">  status=SPI2_ReadWriteByte(reg);//发送寄存器值(位置),并读取状态值   	   </span><br><span class="line"> 	<span class="keyword">for</span>(u8_ctr=<span class="number">0</span>;u8_ctr&lt;<span class="built_in">len</span>;u8_ctr++)</span><br><span class="line">	pBuf[u8_ctr]=SPI2_ReadWriteByte(<span class="number">0XFF</span>);//读出数据</span><br><span class="line">  NRF24L01_CSN=<span class="number">1</span>;       //关闭SPI传输</span><br><span class="line">  <span class="keyword">return</span> status;        //返回读到的状态值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//在指定位置写指定长度的数据</span><br><span class="line">//reg:寄存器(位置)</span><br><span class="line">//*pBuf:数据指针</span><br><span class="line">//<span class="built_in">len</span>:数据长度</span><br><span class="line">//返回值,此次读到的状态寄存器值</span><br><span class="line">u8 NRF24L01_Write_Buf(u8 reg, u8 *pBuf, u8 <span class="built_in">len</span>)</span><br><span class="line">&#123;</span><br><span class="line">	u8 status,u8_ctr;	    </span><br><span class="line"> 	NRF24L01_CSN = <span class="number">0</span>;          //使能SPI传输</span><br><span class="line">	status = SPI2_ReadWriteByte(reg);//发送寄存器值(位置),并读取状态值</span><br><span class="line">	<span class="keyword">for</span>(u8_ctr=<span class="number">0</span>; u8_ctr&lt;<span class="built_in">len</span>; u8_ctr++)SPI2_ReadWriteByte(*pBuf++); //写入数据	 </span><br><span class="line">	NRF24L01_CSN = <span class="number">1</span>;       //关闭SPI传输</span><br><span class="line">	<span class="keyword">return</span> status;          //返回读到的状态值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//启动NRF24L01发送一次数据</span><br><span class="line">//txbuf:待发送数据首地址</span><br><span class="line">//返回值:发送完成状况</span><br><span class="line">u8 NRF24L01_TxPacket(u8 *txbuf)</span><br><span class="line">&#123;</span><br><span class="line">	u8 sta;</span><br><span class="line"> 	SPI2_SetSpeed(SPI_BaudRatePrescaler_8);//spi速度为9Mhz（24L01的最大SPI时钟为10Mhz）   </span><br><span class="line">	NRF24L01_CE=<span class="number">0</span>;</span><br><span class="line">  	NRF24L01_Write_Buf(WR_TX_PLOAD,txbuf,TX_PLOAD_WIDTH);//写数据到TX BUF  <span class="number">32</span>个字节</span><br><span class="line"> 	NRF24L01_CE=<span class="number">1</span>;//启动发送	   </span><br><span class="line">	<span class="keyword">while</span>(NRF24L01_IRQ!=<span class="number">0</span>);//等待发送完成</span><br><span class="line">	sta=NRF24L01_Read_Reg(STATUS);  //读取状态寄存器的值	   </span><br><span class="line">	NRF24L01_Write_Reg(NRF_WRITE_REG+STATUS,sta); //清除TX_DS或MAX_RT中断标志</span><br><span class="line">	<span class="keyword">if</span>(sta&amp;MAX_TX)//达到最大重发次数</span><br><span class="line">	&#123;</span><br><span class="line">		NRF24L01_Write_Reg(FLUSH_TX,<span class="number">0xff</span>);//清除TX FIFO寄存器 </span><br><span class="line">		<span class="keyword">return</span> MAX_TX; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(sta&amp;TX_OK)//发送完成</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> TX_OK;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0xff</span>;//其他原因发送失败</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//启动NRF24L01发送一次数据</span><br><span class="line">//txbuf:待发送数据首地址</span><br><span class="line">//返回值:<span class="number">0</span>，接收完成；其他，错误代码</span><br><span class="line">u8 NRF24L01_RxPacket(u8 *rxbuf)</span><br><span class="line">&#123;</span><br><span class="line">	u8 sta;		    							   </span><br><span class="line">	SPI2_SetSpeed(SPI_BaudRatePrescaler_8); //spi速度为9Mhz（24L01的最大SPI时钟为10Mhz）   </span><br><span class="line">	sta=NRF24L01_Read_Reg(STATUS);  //读取状态寄存器的值    	 </span><br><span class="line">	NRF24L01_Write_Reg(NRF_WRITE_REG+STATUS,sta); //清除TX_DS或MAX_RT中断标志</span><br><span class="line">	<span class="keyword">if</span>(sta&amp;RX_OK)//接收到数据</span><br><span class="line">	&#123;</span><br><span class="line">		NRF24L01_Read_Buf(RD_RX_PLOAD,rxbuf,RX_PLOAD_WIDTH);//读取数据</span><br><span class="line">		NRF24L01_Write_Reg(FLUSH_RX,<span class="number">0xff</span>);//清除RX FIFO寄存器 </span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">	&#125;	   </span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;//没收到任何数据</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//该函数初始化NRF24L01到RX模式</span><br><span class="line">//设置RX地址,写RX数据宽度,选择RF频道,波特率和LNA HCURR</span><br><span class="line">//当CE变高后,即进入RX模式,并可以接收数据了		   </span><br><span class="line">void NRF24L01_RX_Mode(void)</span><br><span class="line">&#123;</span><br><span class="line">	NRF24L01_CE=<span class="number">0</span>;	  </span><br><span class="line">  	NRF24L01_Write_Buf(NRF_WRITE_REG+RX_ADDR_P0,(u8*)RX_ADDRESS,RX_ADR_WIDTH);//写RX节点地址</span><br><span class="line">	  </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+EN_AA,<span class="number">0x01</span>);    //使能通道<span class="number">0</span>的自动应答    </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+EN_RXADDR,<span class="number">0x01</span>);//使能通道<span class="number">0</span>的接收地址  	 </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+RF_CH,<span class="number">40</span>);	     //设置RF通信频率		  </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+RX_PW_P0,RX_PLOAD_WIDTH);//选择通道<span class="number">0</span>的有效数据宽度 	    </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+RF_SETUP,<span class="number">0x0f</span>);//设置TX发射参数,0db增益,2Mbps,低噪声增益开启   </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+CONFIG, <span class="number">0x0f</span>);//配置基本工作模式的参数;PWR_UP,EN_CRC,16BIT_CRC,接收模式 </span><br><span class="line">  	NRF24L01_CE = <span class="number">1</span>; //CE为高,进入接收模式 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//该函数初始化NRF24L01到TX模式</span><br><span class="line">//设置TX地址,写TX数据宽度,设置RX自动应答的地址,填充TX发送数据,选择RF频道,波特率和LNA HCURR</span><br><span class="line">//PWR_UP,CRC使能</span><br><span class="line">//当CE变高后,即进入RX模式,并可以接收数据了		   </span><br><span class="line">//CE为高大于10us,则启动发送.	 </span><br><span class="line">void NRF24L01_TX_Mode(void)</span><br><span class="line">&#123;														 </span><br><span class="line">	NRF24L01_CE=<span class="number">0</span>;	    </span><br><span class="line">  	NRF24L01_Write_Buf(NRF_WRITE_REG+TX_ADDR,(u8*)TX_ADDRESS,TX_ADR_WIDTH);//写TX节点地址 </span><br><span class="line">  	NRF24L01_Write_Buf(NRF_WRITE_REG+RX_ADDR_P0,(u8*)RX_ADDRESS,RX_ADR_WIDTH); //设置TX节点地址,主要为了使能ACK	  </span><br><span class="line"></span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+EN_AA,<span class="number">0x01</span>);     //使能通道<span class="number">0</span>的自动应答    </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+EN_RXADDR,<span class="number">0x01</span>); //使能通道<span class="number">0</span>的接收地址  </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+SETUP_RETR,<span class="number">0x1a</span>);//设置自动重发间隔时间:500us + 86us;最大自动重发次数:<span class="number">10</span>次</span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+RF_CH,<span class="number">40</span>);       //设置RF通道为<span class="number">40</span></span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+RF_SETUP,<span class="number">0x0f</span>);  //设置TX发射参数,0db增益,2Mbps,低噪声增益开启   </span><br><span class="line">  	NRF24L01_Write_Reg(NRF_WRITE_REG+CONFIG,<span class="number">0x0e</span>);    //配置基本工作模式的参数;PWR_UP,EN_CRC,16BIT_CRC,接收模式,开启所有中断</span><br><span class="line">	NRF24L01_CE=<span class="number">1</span>;//CE为高,10us后启动发送</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="SPI模块"><a href="#SPI模块" class="headerlink" title="SPI模块"></a>SPI模块</h2><p>spi.h</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ifndef __SPI2_H</span></span><br><span class="line"><span class="comment">#define __SPI2_H</span></span><br><span class="line"><span class="comment">#include &quot;stm32f10x.h&quot;</span></span><br><span class="line"></span><br><span class="line">	  	    													  </span><br><span class="line">void SPI2_Init(void);			 //初始化SPI口</span><br><span class="line">void SPI2_SetSpeed(u8 SpeedSet); //设置SPI速度   </span><br><span class="line">u8 SPI2_ReadWriteByte(u8 TxData);//SPI总线读写一个字节</span><br><span class="line">		 </span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>spi.c</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;spi2.h&quot;</span></span><br><span class="line"></span><br><span class="line">//以下是SPI模块的初始化代码，配置成主机模式，访问SD Card/W25Q64/NRF24L01						  </span><br><span class="line">//SPI口初始化</span><br><span class="line">//这里针是对SPI2的初始化</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void SPI2_Init(void)</span><br><span class="line">&#123;</span><br><span class="line"> 	GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">  SPI_InitTypeDef  SPI_InitStructure;</span><br><span class="line"></span><br><span class="line">	RCC_APB2PeriphClockCmd(	RCC_APB2Periph_GPIOB, ENABLE );//PORTB时钟使能 </span><br><span class="line">	RCC_APB1PeriphClockCmd(	RCC_APB1Periph_SPI2,  ENABLE );//SPI2时钟使能 	</span><br><span class="line"> </span><br><span class="line">	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_13 | GPIO_Pin_14 | GPIO_Pin_15;</span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;  //PB13/<span class="number">14</span>/<span class="number">15</span>复用推挽输出	<span class="number">13</span>:sck <span class="number">14</span>:miso 15mosi</span><br><span class="line">	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">	GPIO_Init(GPIOB, &amp;GPIO_InitStructure);//初始化GPIOB</span><br><span class="line"></span><br><span class="line"> 	GPIO_SetBits(GPIOB,GPIO_Pin_13|GPIO_Pin_14|GPIO_Pin_15);  //PB13/<span class="number">14</span>/<span class="number">15</span>上拉</span><br><span class="line"></span><br><span class="line">	SPI_InitStructure.SPI_Direction = SPI_Direction_2Lines_FullDuplex;  //设置SPI单向或者双向的数据模式:SPI设置为双线双向全双工</span><br><span class="line">	SPI_InitStructure.SPI_Mode = SPI_Mode_Master;		//设置SPI工作模式:设置为主SPI</span><br><span class="line">	SPI_InitStructure.SPI_DataSize = SPI_DataSize_8b;		//设置SPI的数据大小:SPI发送接收<span class="number">8</span>位帧结构</span><br><span class="line">	SPI_InitStructure.SPI_CPOL = SPI_CPOL_High;		//串行同步时钟的空闲状态为高电平</span><br><span class="line">	SPI_InitStructure.SPI_CPHA = SPI_CPHA_2Edge;	//串行同步时钟的第二个跳变沿（上升或下降）数据被采样</span><br><span class="line">	SPI_InitStructure.SPI_NSS = SPI_NSS_Soft;		//NSS信号由硬件（NSS管脚）还是软件（使用SSI位）管理:内部NSS信号有SSI位控制</span><br><span class="line">	SPI_InitStructure.SPI_BaudRatePrescaler = SPI_BaudRatePrescaler_256;		//定义波特率预分频的值:波特率预分频值为<span class="number">256</span></span><br><span class="line">	SPI_InitStructure.SPI_FirstBit = SPI_FirstBit_MSB;	//指定数据传输从MSB位还是LSB位开始:数据传输从MSB位开始</span><br><span class="line">	SPI_InitStructure.SPI_CRCPolynomial = <span class="number">7</span>;	//CRC值计算的多项式</span><br><span class="line">	SPI_Init(SPI2, &amp;SPI_InitStructure);  //根据SPI_InitStruct中指定的参数初始化外设SPIx寄存器</span><br><span class="line"> </span><br><span class="line">	SPI_Cmd(SPI2, ENABLE); //使能SPI外设</span><br><span class="line">	</span><br><span class="line">	SPI2_ReadWriteByte(<span class="number">0xff</span>);//启动传输</span><br><span class="line">&#125;   </span><br><span class="line">//SPI 速度设置函数</span><br><span class="line">//SpeedSet:</span><br><span class="line">//SPI_BaudRatePrescaler_2   <span class="number">2</span>分频   </span><br><span class="line">//SPI_BaudRatePrescaler_8   <span class="number">8</span>分频   </span><br><span class="line">//SPI_BaudRatePrescaler_16  <span class="number">16</span>分频  </span><br><span class="line">//SPI_BaudRatePrescaler_256 <span class="number">256</span>分频 </span><br><span class="line">  </span><br><span class="line">void SPI2_SetSpeed(u8 SPI_BaudRatePrescaler)</span><br><span class="line">&#123;</span><br><span class="line">  	assert_param(IS_SPI_BAUDRATE_PRESCALER(SPI_BaudRatePrescaler));</span><br><span class="line">	SPI2-&gt;CR1&amp;=<span class="number">0XFFC7</span>;</span><br><span class="line">	SPI2-&gt;CR1|=SPI_BaudRatePrescaler;	//设置SPI2速度 </span><br><span class="line">	SPI_Cmd(SPI2,ENABLE); </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">//SPIx 读写一个字节</span><br><span class="line">//TxData:要写入的字节</span><br><span class="line">//返回值:读取到的字节</span><br><span class="line">u8 SPI2_ReadWriteByte(u8 TxData)</span><br><span class="line">&#123;		</span><br><span class="line">	u8 retry=<span class="number">0</span>;				 	</span><br><span class="line">	<span class="keyword">while</span> (SPI_I2S_GetFlagStatus(SPI2, SPI_I2S_FLAG_TXE) == RESET) //检查指定的SPI标志位设置与否:发送缓存空标志位</span><br><span class="line">	&#123;</span><br><span class="line">		retry++;</span><br><span class="line">		<span class="keyword">if</span>(retry&gt;<span class="number">200</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;			  </span><br><span class="line">	SPI_I2S_SendData(SPI2, TxData); //通过外设SPIx发送一个数据</span><br><span class="line">	retry=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (SPI_I2S_GetFlagStatus(SPI2, SPI_I2S_FLAG_RXNE) == RESET)//检查指定的SPI标志位设置与否:接受缓存非空标志位</span><br><span class="line">	&#123;</span><br><span class="line">		retry++;</span><br><span class="line">		<span class="keyword">if</span>(retry&gt;<span class="number">200</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;	  						    </span><br><span class="line">	<span class="keyword">return</span> SPI_I2S_ReceiveData(SPI2); //返回通过SPIx最近接收的数据					    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="四、接收端"><a href="#四、接收端" class="headerlink" title="四、接收端"></a>四、接收端</h1><h2 id="MOTOR模块"><a href="#MOTOR模块" class="headerlink" title="MOTOR模块"></a>MOTOR模块</h2><p>motor.h</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ifndef __MOTOR_H</span></span><br><span class="line"><span class="comment">#define __MOTOR_H	 </span></span><br><span class="line"><span class="comment">#include &quot;sys.h&quot;</span></span><br><span class="line"><span class="comment">#include &lt;stdbool.h&gt;</span></span><br><span class="line"></span><br><span class="line">//ULN2003驱动</span><br><span class="line"></span><br><span class="line"><span class="comment">#define uint unsigned int</span></span><br><span class="line"><span class="comment">#define uchar unsigned char</span></span><br><span class="line"></span><br><span class="line">void Delay_xms(uint x);//延时函数</span><br><span class="line">void Moto_Init(void);  //步进电机初始化</span><br><span class="line">void Motorcw(void);    //步进电机正转函数</span><br><span class="line">void Motorcw1(<span class="built_in">int</span> speed);   //步进电机<span class="number">1</span>正转函数</span><br><span class="line">void Motorccw(void);   //步进电机反转函数</span><br><span class="line">void Motorccw1(<span class="built_in">int</span> speed);  //步进电机<span class="number">1</span>反转函数</span><br><span class="line">void Motorcw_angle(<span class="built_in">int</span> angle,<span class="built_in">int</span> speed);  //步进电机正转角度函数</span><br><span class="line">void Motorcw_angle1(<span class="built_in">int</span> angle,<span class="built_in">int</span> speed); //步进电机<span class="number">1</span>正转角度函数</span><br><span class="line">void Motorccw_angle(<span class="built_in">int</span> angle,<span class="built_in">int</span> speed); //步进电机反转角度函数</span><br><span class="line">void Motorccw_angle1(<span class="built_in">int</span> angle,<span class="built_in">int</span> speed);//步进电机<span class="number">1</span>反转角度函数</span><br><span class="line">void MotorStop(void);  //步进电机停止函数</span><br><span class="line">void MotorStop1(void); //步进电机<span class="number">1</span>停止函数</span><br><span class="line">void SetMotor(unsigned char InputData);</span><br><span class="line">//void motorNcircle(<span class="built_in">int</span> n,<span class="built_in">bool</span> position);</span><br><span class="line">void motorNcircle(<span class="built_in">int</span> position);</span><br><span class="line"></span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure>
<p>motor.c</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;delay.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;sys.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;stdio.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;motor.h&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsigned short phasecw[<span class="number">4</span>] =&#123;<span class="number">0x0200</span>,<span class="number">0x0100</span>,<span class="number">0x0080</span>,<span class="number">0x0040</span>&#125;;// D-C-B-A   反转</span><br><span class="line">unsigned short phaseccw[<span class="number">4</span>]=&#123;<span class="number">0x0040</span>,<span class="number">0x0080</span>,<span class="number">0x0100</span>,<span class="number">0x0200</span>&#125;;// A-B-C-D   正转</span><br><span class="line"></span><br><span class="line">//引脚初始化</span><br><span class="line">void Moto_Init(void)</span><br><span class="line">&#123;</span><br><span class="line">	 GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">	 RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);</span><br><span class="line">	 GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7 | GPIO_Pin_8 | GPIO_Pin_9;</span><br><span class="line">	 GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">	 GPIO_InitStructure.GPIO_Speed = GPIO_Speed_10MHz;</span><br><span class="line">	 GPIO_Init(GPIOB,&amp;GPIO_InitStructure);</span><br><span class="line">	 GPIO_ResetBits(GPIOB,GPIO_Pin_6 | GPIO_Pin_7 |GPIO_Pin_8 |GPIO_Pin_9 );</span><br><span class="line">&#125;</span><br><span class="line">void MotoRcw(void)  //反转</span><br><span class="line">&#123;  </span><br><span class="line">    <span class="built_in">int</span>  i;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)  </span><br><span class="line">    &#123;  </span><br><span class="line">        GPIO_Write(GPIOB,phasecw[i]);  </span><br><span class="line">        delay_ms(<span class="number">4</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MotoRccw(void)  //正转</span><br><span class="line">&#123;  </span><br><span class="line">    <span class="built_in">int</span> i;  </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)  </span><br><span class="line">    &#123;  </span><br><span class="line">        GPIO_Write(GPIOB,phaseccw[i]);  </span><br><span class="line">        delay_ms(<span class="number">4</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MotorStop(void) //停止</span><br><span class="line">&#123;  </span><br><span class="line">    GPIO_Write(GPIOB,<span class="number">0x0000</span>);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//控制电机正转还是反转某个角度</span><br><span class="line">//direction方向，<span class="number">1</span>为正转，<span class="number">0</span>为反转</span><br><span class="line">//angle角度，可为<span class="number">0</span>-<span class="number">360</span>具有实际意义</span><br><span class="line">void Motor_Ctrl_Direction_Angle(<span class="built_in">int</span> direction, <span class="built_in">int</span> angle)</span><br><span class="line">&#123;</span><br><span class="line">	u16 j;</span><br><span class="line">	<span class="keyword">if</span>(direction == <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">64</span>*angle/<span class="number">45</span>;j++) </span><br><span class="line">		&#123;</span><br><span class="line">			MotoRccw();//正转</span><br><span class="line">		&#125;</span><br><span class="line">		 MotorStop();//停止</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">64</span>*angle/<span class="number">45</span>;j++) </span><br><span class="line">		&#123;</span><br><span class="line">			MotoRcw();//反转</span><br><span class="line">		&#125;</span><br><span class="line">		 MotorStop();//停止</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="主函数-1"><a href="#主函数-1" class="headerlink" title="主函数"></a>主函数</h2><p>mian.c</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#include	&quot;stm32f10x.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;system.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;delay.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;usart.h&quot;</span></span><br><span class="line"><span class="comment">#include	&quot;nrf24l01p.h&quot;	</span></span><br><span class="line"><span class="comment">#include	&quot;spi2.h&quot;</span></span><br><span class="line"><span class="comment">#include  &quot;led.h&quot;</span></span><br><span class="line"><span class="comment">#include  &quot;motor.h&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(void)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">int</span> flag=<span class="number">1</span>;</span><br><span class="line">	u8 temperature=<span class="number">0</span>;</span><br><span class="line">	u8 key,mode;</span><br><span class="line">	u16 t=<span class="number">0</span>;			 </span><br><span class="line">	u8 tmp_buf[<span class="number">180</span>];		    </span><br><span class="line">	delay_init();	    	 														//延时函数初始化	  </span><br><span class="line">	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);	//设置中断优先级分组为组<span class="number">2</span>：<span class="number">2</span>位抢占优先级，<span class="number">2</span>位响应优先级</span><br><span class="line">	USART1_Config();	 															//串口初始化为<span class="number">115200</span></span><br><span class="line"> 	NRF24L01_Init();    														//初始化NRF24L01 </span><br><span class="line">	Moto_Init();</span><br><span class="line">	LED_Init();</span><br><span class="line">	//delay_ms(<span class="number">1000</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(NRF24L01_Check())		//等待模块应答</span><br><span class="line">	&#123;</span><br><span class="line">		printf(<span class="string">&quot;NRF24L01 Error\r\n&quot;</span>);</span><br><span class="line">		delay_ms(<span class="number">500</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(<span class="string">&quot;NRF24L01 OK\r\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	mode=<span class="number">0</span>;//接收模式</span><br><span class="line">//	mode=<span class="number">1</span>;//发送模式</span><br><span class="line">	</span><br><span class="line"> 	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(mode==<span class="number">0</span>)//RX模式</span><br><span class="line">		&#123;</span><br><span class="line">			printf(<span class="string">&quot;NRF24L01 RX_Mode\r\n&quot;</span>);</span><br><span class="line">			printf(<span class="string">&quot;Received DATA:&quot;</span>);</span><br><span class="line">			NRF24L01_RX_Mode();</span><br><span class="line">			<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(NRF24L01_RxPacket(&amp;temperature)==<span class="number">0</span>)//一旦接收到信息,则显示出来.</span><br><span class="line">				&#123;</span><br><span class="line">					printf(<span class="string">&quot;%d\r\n&quot;</span>,temperature);</span><br><span class="line">					LED0=!LED0;</span><br><span class="line">					<span class="keyword">if</span>(temperature&gt;<span class="number">25</span>&amp;&amp;flag==<span class="number">1</span>)</span><br><span class="line">					&#123;</span><br><span class="line">					Motor_Ctrl_Direction_Angle(<span class="number">1</span>,<span class="number">645</span>);</span><br><span class="line">						flag=<span class="number">0</span>;</span><br><span class="line">						</span><br><span class="line">					&#125;</span><br><span class="line">					//tmp_buf[<span class="number">179</span>]=<span class="number">0</span>;//加入字符串结束符</span><br><span class="line">					</span><br><span class="line">					//delay_ms(<span class="number">10</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> delay_us(<span class="number">100</span>);			    </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/02/my-first-blog/" rel="prev" title="my first blog">
      <i class="fa fa-chevron-left"></i> my first blog
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.</span> <span class="nav-text">一、准备工作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%8F%91%E9%80%81%E7%AB%AF"><span class="nav-number">2.</span> <span class="nav-text">二、发送端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DHT11%E6%A8%A1%E5%9D%97"><span class="nav-number">2.1.</span> <span class="nav-text">DHT11模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="nav-number">2.2.</span> <span class="nav-text">主函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%8F%8C%E7%AB%AF"><span class="nav-number">3.</span> <span class="nav-text">三、双端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NRF24L01%E6%A8%A1%E5%9D%97"><span class="nav-number">3.1.</span> <span class="nav-text">NRF24L01模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SPI%E6%A8%A1%E5%9D%97"><span class="nav-number">3.2.</span> <span class="nav-text">SPI模块</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%8E%A5%E6%94%B6%E7%AB%AF"><span class="nav-number">4.</span> <span class="nav-text">四、接收端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MOTOR%E6%A8%A1%E5%9D%97"><span class="nav-number">4.1.</span> <span class="nav-text">MOTOR模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B0-1"><span class="nav-number">4.2.</span> <span class="nav-text">主函数</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="invincible"
      src="/images/touxiang.jpg">
  <p class="site-author-name" itemprop="name">invincible</p>
  <div class="site-description" itemprop="description">生活不易，且行珍惜。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">invincible</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


  
  
   <script type="text/javascript" src="/js/src/clicklove.js"></script>
</body>
</html>